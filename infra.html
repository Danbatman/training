<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Ants - formation</title>

		<meta name="description" content="The slides used to teach companies how to code like hackers.">
		<meta name="author" content="Ants">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<link rel="stylesheet" href="css/ants.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );

			function changeFont(){
				console.log('changing color')
				document.getElementById('eventExample').classList.toggle('color');
			}

			document.addEventListener('click', changeFont);
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				
				<section data-transition="slide" data-background="#5BBDBF" data-background-transition="zoom">

					<!-- API -->
					<section>
						<h1>API</h1>
						<h3>Structurer les services</h3>
					</section>

					<section>
						<h3>API</h3>
						<p>Une Application Programmtion Interface est un ensemble de <strong>contraintes sur les entrées/sorties</strong> d'un programme pour que tout le monde puisse se parler.</p>
					</section>

					<section>
						<h3>API REST</h3>
						<ul>
							<li>Interface uniforme</li>
							<li>Stateless</li>
							<li>Cacheable</li>
							<li>Client-Server: separation of concerns</li>
							<li>Layered-System</li>
						</ul>
					</section>

					<section>
						<h3>API REST</h3>
						<p>Les representations des objets sont des URI:</p>
						<pre><code class="bash" data-trim contenteditable>
http://api.example.com/client/123
						</code></pre>
					</section>

					<section>
						<h3>API REST</h3>
						<p>Avec le protocole HTTP:</p>
						<ul>
							<li>GET</li>
							<li>POST</li>
							<li>PUT</li>
							<li>DELETE</li>
						</ul>
					</section>

					<section>
						<h3>Github API</h3>
						<pre><code class="bash" data-trim contenteditable>
curl https://api.github.com/users/vallettea
{
  "login": "vallettea",
  "id": 371303,
  "avatar_url": "https://avatars.githubusercontent.com/u/371303?v=3",
  "gravatar_id": "",
  "url": "https://api.github.com/users/vallettea",
  "html_url": "https://github.com/vallettea",
  "followers_url": "https://api.github.com/users/vallettea/followers",
  "following_url": "https://api.github.com/users/vallettea/following{/other_user}",
  "gists_url": "https://api.github.com/users/vallettea/gists{/gist_id}",
  "starred_url": "https://api.github.com/users/vallettea/starred{/owner}{/repo}",
  "subscriptions_url": "https://api.github.com/users/vallettea/subscriptions",
  "organizations_url": "https://api.github.com/users/vallettea/orgs",
  "repos_url": "https://api.github.com/users/vallettea/repos",
  "events_url": "https://api.github.com/users/vallettea/events{/privacy}",
  "received_events_url": "https://api.github.com/users/vallettea/received_events",
  "type": "User",
  "site_admin": false,
  "name": "Alexandre Vallette",
  "company": null,
  "blog": null,
  "location": null,
  "email": null,
  "hireable": null,
  "bio": null,
  "public_repos": 50,
  "public_gists": 61,
  "followers": 32,
  "following": 3,
  "created_at": "2010-08-20T21:09:06Z",
  "updated_at": "2016-02-26T23:22:07Z"
}
						</code></pre>
					</section>

					<section>
						<h3>API nodejs</h3>
						<p>Avec <a href="http://expressjs.com/">express.js:</a></p>
						<pre><code class="hsjs" data-trim contenteditable>
app.get('/user/:name', function(req, res){
    var user = req.params.user;
    console.log('requesting sensor user', user);

    // result of the call to a db
    var data = {
        name: "toto",
        age: 12
    };

    res.status(200).send(data);

});
						</code></pre>
					</section>

					<section>
						<h3>API python</h3>
						<p>Avec <a href="http://flask.pocoo.org/">flask:</a></p>
						<pre><code class="hsjs" data-trim contenteditable>
from flask import Flask, jsonify

app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"

@app.route('/user/<username>')
def show_user_profile(username):
    list = [
        {'param': 'foo', 'val': 2},
        {'param': 'bar', 'val': 10}
    ]
    return jsonify(result=list)

if __name__ == "__main__":
    app.run()
						</code></pre>
					</section>

					<section>
						<h3>API temps réél</h3>
						<p>Webhooks:</p>
						<pre><code class="hsjs" data-trim contenteditable>
var githubhook = require('githubhook');
// configure listener for github changes
var github = githubhook({/* options */
	   host: "0.0.0.0",
   port: 8082,
   path: "/pushchanges",
   secret: "123456"  
  });

// listen to push on github on branch master
github.on('push', function (repo, ref, data) {
	  var branchName = _s.strRightBack(ref, "/");
	  var fullNameRepository = data.repository.full_name;
	  var removedFilesArray = data["head_commit"]["removed"];
	  var addedFilesArray = data["head_commit"]["added"];
	  var modifiedFilesArray = data["head_commit"]["modified"];
});

// listen to github push
github.listen();
						</code></pre>
					</section>

					<section>
						<h3>API temps réél</h3>
						<p>Avec <a href="http://socket.io">socket.io:</a></p>
						<pre><code class="hsjs" data-trim contenteditable>
var io = require('socket.io')(80);
var cfg = require('./config.json');
var tw = require('node-tweet-stream')(cfg);
tw.track('socket.io');
tw.track('javascript');
tw.on('tweet', function(tweet){
  io.emit('tweet', tweet);
});
						</code></pre>
					</section>


					<!-- scrapping -->
					<section>
						<h1>Scrapping</h1>
						<h3>Prendre sa data</h3>
					</section>

					<section>
						<h3>Scrapping</h3>
						<p>Toute information visible sur internet peut être récupérée.</p>
						<ul>
							<li>API: methode officielle</li>
							<li>html: exemple BeautifulSoup</li>
							<li>js: casperjs</li>
						</ul>
					</section>

					<section>
						<h3>Scrapping</h3>
						<p>Exemple: scrapper la météo avec python</p>
						<pre><code class="python" data-trim contenteditable>
soup = BeautifulSoup(urllib2.urlopen("http://www....").read())

a = soup('table', {'width': '100%', "border":"1", "cellpadding":"1" ,"cellspacing":"0", "bordercolor":"#C0C8FE" ,"bgcolor":"#EBFAF7"})[0]

b = a.findAll("tr")
						</code></pre>
					</section>

					<section>
						<h3>Scrapping</h3>
						<p>Exemple: scrapper la qualité de l'eau</p>
						<pre><code class="hsjs" data-trim contenteditable>
casper.start("http://...", function() {
    this.selectOptionByValue('select[name="departement"]', "033") 
});

casper.then( function() {
    this.selectOptionByValue('select[name="communeDepartement"]', "063") 
});

casper.then(function(){
    this.waitUntilVisible('input[value="Rechercher"]', function() {
        this.click('input[value="Rechercher"]');
    });
})
						</code></pre>
					</section>

					<!-- ansible -->
					<section>
						<h1>Ansible</h1>
						<h3>Déployer et maintenir</h3>
					</section>

					<section>
						<h3>Ansible</h3>
						<p>Ansible permet de déployer automatiquement une infrastructure complexe sur plusieurs machines.</p>
					</section>

					<section>
						<h3>Ansible</h3>
						<p>Avantages :</p>
						<ul>
							<li><strong>léger</strong>: tout fonctionne par ssh</li>
							<li><strong>communauté</strong>: de nombreux modules</li>
							<li><strong>tower</strong>: permet de scaler en délégant des tâches dans une équipe</li>
						</ul>
					</section>

					<section>
						<h3>Ansible</h3>
						<p>Incovénient :</p>
						<ul>
							<li><strong>distribution specific</strong>: dépend de l'os</li>
						</ul>
					</section>

					<section>
						<h3>Installation</h3>
						<p>Sur le master : </p>
						http://docs.ansible.com/ansible/intro_installation.html
						<p>Sur les slaves : </p>
						<ul>
							<li>id_rsa.pub du master dans authorized_hosts</li>
							<li>install necessary deps</li>
						</ul>	
						<pre><code class="bash" data-trim contenteditable>
apt-get update
apt-get install -y python python-pip
						</code></pre>

					</section>

					<section>
						<h3>Inventory</h3>
						<p>Chaque machine doit apparaitre dans le fichier hosts et elle peut apparatenir a différents groupes :</p>
						<pre><code class="bash" data-trim contenteditable>
[webservers]
139.162.203.160

[dbservers]
139.162.203.160
						</code></pre>
						<p>vous pouvez dès lors ustiliser des commandes par groupes avec des partterns:</p>
						<pre><code class="bash" data-trim contenteditable>
ansible webservers -m service -a "name=httpd state=restarted"
						</code></pre>

					</section>

					<section>
						<h3>ping</h3>
						<pre><code class="bash" data-trim contenteditable>
ansible all -vvvv -m ping -u root
ansible all -u root -a "ls /"
						</code></pre>
					</section>

					<section>
						<h3>ad-hoc command</h3>
						<p>Pour executer des commandes :</p>
						<pre><code class="bash" data-trim contenteditable>
ansible all -u root -a "ls /"
ansible dbservers -m copy -a "src=/etc/hosts dest=/tmp/hosts" #copy a file
ansible webservers -m service -a "name=httpd state=started" #ensure a service is running 
						</code></pre>
					</section>

					<section>
						<h3>Playbooks</h3>
						<p>Un playbook est la recette de fabrication d'une infrastructre ou d'un service :</p>
						<pre><code class="yml" data-trim contenteditable>
playbook
	play
		task
		task
	play
		task

handler
						</code></pre>
						et s'execute avec la commande

						<pre><code class="bash" data-trim contenteditable>
ansible-playbook playbook.yml -f 10
						</code></pre>

					</section>

					<section>
						<h3>Playbooks</h3>
						<p>Ce qui donne :</p>
						<pre><code class="yml" data-trim contenteditable>
---
- hosts: webservers
  remote_user: root

  tasks:
  - name: ensure apache is at the latest version
    yum: name=httpd state=latest
  - name: write the apache config file
    template: src=/srv/httpd.j2 dest=/etc/httpd.conf

- hosts: databases
  remote_user: root

  tasks:
  - name: ensure postgresql is at the latest version
    yum: name=postgresql state=latest
  - name: ensure that postgresql is started
    service: name=postgresql state=running
						</code></pre>
					</section>



					<section>
						<h3>Task</h3>
						<p>Une task décrit une opération :</p>
						<pre><code class="hsjs" data-trim contenteditable>
- name: install httpd
  apt: name=httpd-2.0 state present
						</code></pre>
					</section>


					<section>
						<h3>Roles</h3>
						<p>Les playbooks peuvent s'imbriquer pour constituer une infra par building blocks :</p>
						<p> Ansible Galaxy: permet de trouver des rôles tout faits.</p>
					</section>

					<section>
						<h2>Demo-time</h2>
					</section>


					<!-- docker -->
					<section>
						<h1>Docker</h1>
						<h3>Microservices</h3>
					</section>

					<section>
						<h3>Docker</h3>
						<p>Docker permet de virtualiser de manière légère.</p>
					</section>

					<section>
						<h3>Docker</h3>
						<p>Avantages</p>
						<ul>
							<li>Indépendance de l'OS </li>
							<li>Communauté</li>
							<li>Performances natives</li>
						</ul>
					</section>

					<section>
						<h3>Docker</h3>
						<p>Inconvénients:</p>
						<ul>
							<li>pas assez mature pour la prod</li>
							<li>les containers restent lourds</li>
							<li>couche supplémentaire</li>
						</ul>
					</section>

					<section>
						<h3>Docker</h3>
						<p>Architecture</p>
						<img class="stretch" src="http://www.techworldwookie.com/images/docker_machine.jpg">
					</section>

					<section>
						<h3>Docker</h3>
						<p>Docker-machine</p>
						<img class="stretch" src="https://sreeninet.files.wordpress.com/2015/05/docker4.png">
					</section>

					<section>
						<h3>Docker</h3>
						<p>Docker-machine</p>
						<pre><code class="shell" data-trim contenteditable>
docker-machine start default
docker-machine env default
						</code></pre>
					</section>

					<section>
						<h3>Docker</h3>
						<p>Docker-client</p>
						<pre><code class="shell" data-trim contenteditable>
docker ps
docker run
docker exec
docker logs
						</code></pre>
					</section>

					<section>
						<h3>Docker</h3>
						<p>Docker file</p>
						<pre><code class="yml" data-trim contenteditable>
# Basic python setup for science application (numpy, ploting etc)
FROM vallettea/base:v1

MAINTAINER Alexandre Vallette, alexandre.vallette@ants.builders

RUN apt-get update && apt-get install -y \
	build-essential \
	curl

RUN curl -sL https://deb.nodesource.com/setup | zsh -

RUN apt-get update && apt-get install -y \
	nodejs 
						</code></pre>
					</section>

					<section>
						<h3>Docker</h3>
						<p>Docker-hub</p>
						<pre><code class="shell" data-trim contenteditable>
docker pull nodejs
docker pull ants/predictionio

docker push ants/myimage
						</code></pre>
					</section>

					<section>
						<h3>Docker</h3>
						<p>Docker volumes</p>
						<pre><code class="shell" data-trim contenteditable>
docker -v /emplacement/machine:/emplacement/dans/le/container
						</code></pre>
					</section>

					<!-- scala -->
					<section>
						<h3>Scala</h3>
						<p>Scala est un jeune langage fonctionnel qui hérite des concepts de la programmation objet.</p>
					</section>

					<section>
						<h3>Avantages:</h3>
						<ul>
							<li>scalable</li>
							<li>stream/concurrent processing</li>
							<li>moderne (map, pattern matching etc)</li>
							<li>java sans la verbosité</li>
							<li>typage intéressant</li>
						</ul>
					</section>

					<section>
						<h3>Inconvénient:</h3>
						<ul>
							<li>compilateur lent (sbt)</li>
							<li>JVM</li>
						</ul>
					</section>

					<section>
						<h3>Scala</h3>
						<pre><code class="shell" data-trim contenteditable>
val xs = List(1,2,3)
val xs = List(4,5,6)
(xs zip ys) map { case (x,y) => x*y }
xs flatMap {x => ys map {y => x*y}}
						</code></pre>
					</section>

					<!-- spark -->
					<section>
						<h3>Spark</h3>
						<p>Spark est un framework de calcul distribué basé sur hadoop et scala.</p>
					</section>

					<section>
						<h3>Avantages:</h3>
						<ul>
							<li>communauté</li>
							<li>spark-ml, graphx</li>
							<li>shell</li>
						</ul>
					</section>

					<section>
						<h3>Inconvénient:</h3>
						<ul>
							<li>lourd à mettre en place</li>
						</ul>
					</section>

					<section>
						<h3>Spark</h3>
						<p>depuis docker:</p>
						<pre><code class="shell" data-trim contenteditable>
docker pull sequenceiq/spark:1.6.0
docker run -it -p 8088:8088 -p 8042:8042 -v $PWD:/data sequenceiq/spark:1.6.0 bash
						</code></pre>
						<a href="http://192.168.99.100:8088/cluster/nodes">http://192.168.99.100:8088/cluster/nodes</a>
					</section>

					<section>
						<h3>Spark</h3>
						<pre><code class="shell" data-trim contenteditable>
val textFile = sc.textFile("README.md")
val name2col = textFile.first().split(";").zipWithIndex.map({case (value,index) => (value -> index)}).toMap

textFile
    .map(line => line.split(";"))
    .filter(entries => (entries(name2col("col1")) == "3")
    .flatMap(entries => {
        try {
            Some(Array(entries(name2col("col2"), entries(name2col("col3")).mkString(";"))
        } catch {
            case e : Exception =>
            println("error in date parsing")
            None
        }
    })
    .repartition(1)
    .saveAsTextFile(output)
						</code></pre>
					</section>

				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>
<!-- 		<script src="https://cdn.rawgit.com/knsv/mermaid/0.5.8/dist/mermaid.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mermaid/0.5.8/mermaid.css">
		<script>mermaid.initialize({startOnLoad:true});</script> -->

		<style type="text/css">
			.reveal section img {
			    background: none;
			    border: none;
			    box-shadow: none;
			}
		</style>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/math/math.js', async: true }
				]
			});

			// to make iframe background clickable
			Reveal.addEventListener('slidechanged', function(event) {               
			     if($(event.currentSlide).attr('data-background-iframe')) {
			          $('.reveal > .backgrounds').css('z-index', 1);
			     } else {
			          $('.reveal > .backgrounds').css('z-index', 0);
			     }                  
			});

		</script>

	</body>
</html>